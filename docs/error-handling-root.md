# エラーハンドリング

## 目次

1. [はじめに](#はじめに)
2. [エラーの種類](#エラーの種類)
3. [共通のエラーハンドリング方針](#共通のエラーハンドリング方針)
4. [バックエンドのエラーハンドリング](#バックエンドのエラーハンドリング)
5. [フロントエンドのエラーハンドリング](#フロントエンドのエラーハンドリング)
6. [ログ記録](#ログ記録)

## はじめに

本ドキュメントは、Typetalk Sentimentプロジェクトにおけるエラーハンドリングの方針と実装方法について説明するものである。適切なエラーハンドリングは、アプリケーションの安定性、セキュリティ、およびユーザーエクスペリエンスの向上に不可欠である。

## エラーの種類

Typetalk Sentimentプロジェクトで発生する可能性のある主なエラーの種類は以下の通りである

1. ネットワークエラー
    - API通信時のタイムアウトや接続エラーにより発生する
2. 認証エラー
    - 無効なトークン、アクセス権限不足により発生する
3. バリデーションエラー
    - 不正な入力値、必須項目の欠落により発生する
4. 外部サービスエラー
    - Typetalk APIやAmazon Comprehendとの連携時に発生する
5. アプリケーション内部エラー
    - 予期しない例外、ロジックエラーにより発生する

## 共通のエラーハンドリング方針

1. エラーの発生箇所をできるだけ特定し、適切なエラーメッセージを生成する
2. ユーザーに分かりやすいエラーメッセージを表示する
3. 開発者向けの詳細なエラー情報をログに記録する
4. セキュリティに関わる情報(スタックトレースなどをユーザーに開示しない
5. 可能な場合は、エラーからの回復手段をユーザーに提示する

## バックエンドのエラーハンドリング

バックエンドのエラーハンドリングの詳細については、[バックエンドエラーハンドリング](../apps/api/docs/error-handling-api.md)を参照してください。

## フロントエンドのエラーハンドリング

フロントエンドのエラーハンドリングの詳細については、[フロントエンドエラーハンドリング](../apps/web/docs/error-handling-web.md)を参照してください。

## ログ記録

エラー発生時のログは、構造化ログフォーマット(JSON)で記録する。各サブシステムは以下の共通項目を必ず含めること

1. 基本情報(必須)
    - タイムスタンプ(ISO 8601形式、ミリ秒まで)
    - ログレベル
    - メッセージ

2. エラー詳細
    - エラーメッセージ
    - スタックトレース

各サブシステムは、それぞれの要件に応じて追加の情報を記録する。詳細は以下のドキュメントを参照すること

- [フロントエンドのエラーハンドリング](../apps/web/docs/error-handling-web.md)
- [バックエンドのエラーハンドリング](../apps/api/docs/error-handling-api.md)
