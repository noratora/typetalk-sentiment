# Typetalk Sentiment API コーディング規約

このドキュメントは、Typetalk Sentiment APIのコーディング規約を定義するものである。

## 目次

1. [コードフォーマットとリンター](#コードフォーマットとリンター)
2. [インポート](#インポート)
3. [型ヒント](#型ヒント)
4. [ドキュメンテーション](#ドキュメンテーション)
5. [エラーハンドリング](#エラーハンドリング)
6. [テスト](#テスト)
7. [命名規則](#命名規則)
8. [設定と環境変数](#設定と環境変数)
9. [ログ出力](#ログ出力)
10. [関連ドキュメント](#関連ドキュメント)

## コードフォーマットとリンター

本プロジェクトでは、以下の設定に従ってコードを記述すること

- [Ruff](https://docs.astral.sh/ruff/)を使用してコードをフォーマットおよびリントする
- 行の最大長は88文字とする (Ruffのデフォルト設定)

コードスタイルの基本設定は[.editorconfig](../.editorconfig)で定義され、自動的に適用される。
その他の設定の詳細は[pyproject.toml](../pyproject.toml)を参照のこと。

## インポート

インポートの順序とフォーマットはRuffによって自動的に適用される。開発者が手動でインポートの順序を管理する必要はない。

インポートの順序については、[Ruffのインポートソートドキュメント](https://docs.astral.sh/ruff/rules/#isort-i)を参照すること。

## 型ヒント

- すべての関数とメソッドに型ヒントを付けること。
- 複雑な型は`typing`モジュールを使用して表現すること。
- [mypy](https://mypy.readthedocs.io/)を使用して静的型チェックを行うこと。pyproject.tomlに定義されたmypyの設定に従うこと。

mypyを実行するには、以下のコマンドを使用する

```sh
mypy
```

注: コマンドラインで引数を指定する必要はない。pyproject.tomlの設定が適用される。

## ドキュメンテーション

パブリックなクラス、メソッド、関数には必ずdocstringを付けること。Googleスタイルのdocstringを使用すること。

docstringの例については、[typetalk_api.py](../src/infrastructure/typetalk/typetalk_api.py)を参照のこと。

## エラーハンドリング

- 適切な例外処理を行い、エラーメッセージは明確で有用なものとすること。
- カスタム例外クラスを定義し、アプリケーション固有の例外を表現すること。

詳細なエラーハンドリングについては、[エラーハンドリング](error-handling-api.md)を参照すること。

## テスト

- すべての公開メソッドとクラスにユニットテストを書くこと。
- テストケースは`pytest`を使用して記述すること。
- テストファイルは`tests/`ディレクトリに配置し、テスト対象のモジュールと同じディレクトリ構造を維持すること。

テストの命名規則:

- テストファイル: `test_<モジュール名>.py`
- テスト関数: `test_<テスト対象の関数名>_<テストシナリオ>`

詳細なテスト方法については、[テスト方法](testing-api.md)を参照すること。

## 命名規則

基本的に[PEP 8](https://peps.python.org/pep-0008/#naming-conventions)の命名規則に従うこと。主な規則は以下の通りである

- クラス名: UpperCamelCase
- 関数名、変数名: snake_case
- 定数: UPPER_CASE_WITH_UNDERSCORES
- プライベートメソッドやプライベート変数: 先頭にアンダースコア

## 設定と環境変数

環境変数の管理には`pydantic_settings`を使用すること。

`Settings`クラスの定義については、[config.py](../src/core/config.py)を参照すること。

## ログ出力

- 標準の`logging`モジュールを使用すること。
- ログレベルを適切に設定し、重要な情報や例外をログに記録すること。

ログ設定の実装については、[logger.py](../src/core/logger/logger.py)を参照すること。

## 関連ドキュメント

- [共通コーディング規約](../../../docs/coding-standards-root.md)
- [テスト戦略概要](../../../docs/testing-strategy.md)
- [エラーハンドリング](../../../docs/error-handling-root.md)
